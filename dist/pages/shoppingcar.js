"use strict";var _createClass=function(){function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}require(["../scripts/libs/config.js"],function(){require(["jquery","cookie"],function(a){a(window).scroll(function(){a(window).scrollTop()>=a("#chat_box_all").offset().top+a("#chat_box_all").outerHeight()+a(".cart_bottom_all").height()-a(window).height()?a(".cart_bottom_all").removeClass("fixed"):a(".cart_bottom_all").addClass("fixed")}),new(function(){function e(t){_classCallCheck(this,e),this.url=t.url,this.tbody=t.tbody,this.getCookie(),this.load()}return _createClass(e,[{key:"getCookie",value:function(){this.goods=JSON.parse(a.cookie("goods"))}},{key:"load",value:function(){var e=this;a.ajax({url:this.url,success:function(t){e.res=t,e.display()}})}},{key:"display",value:function(){var e=this,i="";a.each(this.res,function(t,c){a.each(e.goods,function(t,e){if(c.id==e.id){var o=(.88*c.price).toFixed(2),n=parseInt(e.num)*parseFloat(c.price.slice(0,c.price.length-1));i+='<div class="mc chosen" huohao="'+e.id+'">\n\t\t\t\t\t\t\t\t\t\t<div class="c_checkbox">\n\t\t\t\t\t\t\t\t\t\t\t<input type="checkbox" class="single_sel" value="1" checked="checked" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_goods">\n\t\t\t\t\t\t\t\t\t\t\t<a href="details.html" target="_blank">\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="'+c.img+'"/>\n\t\t\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="details.html" target="_blank">'+c.info+'</a>\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_price retail">\n\t\t\t\t\t\t\t\t\t\t\t￥<i>'+c.price+'</i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_price">\n\t\t\t\t\t\t\t\t\t\t\t<b class="member_price">￥'+o+'</b>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_price">\n\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" value="1" />\n\t\t\t\t\t\t\t\t\t\t\t<div class="choose_amount">\n\t\t\t\t\t\t\t\t\t\t\t\t<a class="btn_reduce" href="javascript:;">-</a>\n\t\t\t\t\t\t\t\t\t\t\t\t<input class="num" type="text" value="'+e.num+'" maxlength="3" />\n\t\t\t\t\t\t\t\t\t\t\t\t<a class="btn_add" href="javascript:;">+</a>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_price price1">\n\t\t\t\t\t\t\t\t\t\t\t<b>￥<input style="text-align:center" value="'+n+'" /></b>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_price weight">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="c_price"><a href="#" class="a_put">加入收藏</a>\n\t\t\t\t\t\t\t\t\t\t\t<delete href="#" class="a_cancel">删除</delete>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>'}})}),this.tbody.html(i),this.calculate(),this.addEvent(),this.del(),this.getgoodsnum(),this.sel(),this.selAll()}},{key:"listtatol",value:function(t,e){a(".price1 b input").eq(t).val(e*parseFloat(a(".retail i").eq(t).html())),console.log(a(".price1 b input"))}},{key:"calculate",value:function(){var t=0,e=Array.from(document.querySelectorAll(".price1 b input"));console.log(e);for(var o=0;o<e.length;o++)t+=parseFloat(e[o].value);a("#c_count strong").html(t)}},{key:"addEvent",value:function(){var n=this;a.each(a(".choose_amount .btn_add"),function(t,e){a(e).on("click",function(){var e=parseInt(a(".choose_amount .num").eq(t).val());e++,a(".choose_amount .num").eq(t).val(e),n.listtatol(t,e),n.calculate(),n.id=a(".chosen").eq(t).attr("huohao"),n.setCookie(function(t){n.goods[t].num=e}),n.getgoodsnum()})}),a.each(a(".choose_amount .btn_reduce"),function(t,e){a(e).on("click",function(){var e=parseInt(a(".choose_amount .num").eq(t).val());--e<=1&&(e=1),a(".choose_amount .num").eq(t).val(e),n.listtatol(t,e),n.calculate(),n.id=a(".chosen").eq(t).attr("huohao"),n.setCookie(function(t){n.goods[t].num=e}),n.getgoodsnum()})}),a.each(a(".choose_amount input"),function(o,t){a(t).on("input",function(){var t=a(this).val();if(t){var e=parseInt(t);n.listtatol(o,e),n.calculate(),n.id=a(".chosen").eq(o).attr("huohao"),n.setCookie(function(t){n.goods[t].num=e})}n.getgoodsnum()})})}},{key:"del",value:function(){var e=this;this.tbody.on("click","delete",function(){a(this).parent().parent().remove(),e.id=a(this).parent().parent().attr("huohao"),e.setCookie(function(t){e.goods.splice(t,1)}),e.calculate(),e.getgoodsnum()})}},{key:"setCookie",value:function(t){for(var e=0;e<this.goods.length;e++)if(this.goods[e].id==this.id){t(e);break}a.cookie("goods",JSON.stringify(this.goods))}},{key:"getgoodsnum",value:function(){var o=0;a.each(a(".c_checkbox .single_sel"),function(t,e){o+=parseInt(a(e).parent().siblings(".c_price").children(".choose_amount").find(".num").val())}),a("#c_count b").html(o)}},{key:"sel",value:function(){var o=this;a.each(a(".c_checkbox .single_sel"),function(t,e){a(e).on("click",function(){a(this).is(":checked")?a(this).prop("checked",!1):a(this).prop("checked",!0),a(".c_checkbox .single_sel").is(":checked").length!=a(".chosen").length&&a(".h_goods .all_sel").prop("checked",!1),o.calculate(),o.getgoodsnum()})})}},{key:"selAll",value:function(){var o=this;a(".h_goods .all_sel").on("click",function(){a(this).prop("checked")?(a(this).prop("checked",!1),a.each(a(".c_checkbox .single_sel"),function(t,e){a(e).prop("checked",!1),o.calculate(),o.getgoodsnum()})):(a(this).prop("checked",!0),a.each(a(".c_checkbox .single_sel"),function(t,e){a(e).prop("checked",!0),o.calculate(),o.getgoodsnum()}))})}}]),e}())({url:"../ajax/data/list.json",tbody:a(".cart_box")})})});